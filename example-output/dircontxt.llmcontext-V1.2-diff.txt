[DIRCONTXT_LLM_DIFF_V1]
Version Change: V1.1 -> V1.2

<CHANGES_SUMMARY>
[MODIFIED] TODO.md
</CHANGES_SUMMARY>

<UPDATED_DIRECTORY_TREE>
[D]  (ID:ROOT, MOD:1763224198)
  [F] example-output.txt (ID:F001, MOD:1759960153, SIZE:121641)
  [F] .dircontxtignore (ID:F002, MOD:1759959022, SIZE:791)
  [F] Makefile (ID:F003, MOD:1763215111, SIZE:4475)
  [F] usage.md (ID:F004, MOD:1759958907, SIZE:6210)
  [F] TODO.md (ID:F005, MOD:1763224198, SIZE:7228)
  [F] README.md (ID:F006, MOD:1763212880, SIZE:11018)
  [D] src (ID:D007, MOD:1763223953)
    [F] src/diff.c (ID:F008, MOD:1763220197, SIZE:5911)
    [F] src/utils.h (ID:F009, MOD:1749021358, SIZE:2084)
    [F] src/dctx_reader.h (ID:F010, MOD:1749025324, SIZE:3671)
    [F] src/ignore.h (ID:F011, MOD:1759958628, SIZE:2621)
    [F] src/walker.h (ID:F012, MOD:1749021664, SIZE:1172)
    [F] src/version.h (ID:F013, MOD:1763218722, SIZE:1459)
    [F] src/writer.c (ID:F014, MOD:1749021848, SIZE:10025)
    [F] src/llm_formatter.c (ID:F015, MOD:1763221710, SIZE:12723)
    [F] src/config.h (ID:F016, MOD:1763215091, SIZE:815)
    [F] src/platform.c (ID:F017, MOD:1763222932, SIZE:3770)
    [F] src/datatypes.h (ID:F018, MOD:1759958756, SIZE:2192)
    [F] src/walker.c (ID:F019, MOD:1763222259, SIZE:7666)
    [F] src/diff.h (ID:F020, MOD:1763218814, SIZE:1732)
    [F] src/ignore.c (ID:F021, MOD:1759958569, SIZE:8266)
    [F] src/dctx_reader.c (ID:F022, MOD:1749025395, SIZE:12686)
    [F] src/utils.c (ID:F023, MOD:1749029164, SIZE:6857)
    [F] src/main.c (ID:F024, MOD:1763223953, SIZE:9224)
    [F] src/config.c (ID:F025, MOD:1763215082, SIZE:3685)
    [F] src/llm_formatter.h (ID:F026, MOD:1763221681, SIZE:2339)
    [F] src/version.c (ID:F027, MOD:1763218771, SIZE:2509)
    [F] src/writer.h (ID:F028, MOD:1749028956, SIZE:1210)
    [F] src/platform.h (ID:F029, MOD:1749021163, SIZE:2566)
</UPDATED_DIRECTORY_TREE>

<FILE_CONTENT_START ID="F005" PATH="TODO.md">
## TODO: Implement Advanced Ignore File Handling

Test 3
This task focuses on upgrading the `dircontxt` ignore system to be more robust, automatic, and feature-rich, closely mirroring the functionality of Git's `.gitignore`.

### Phase 1: Design and Scoping

*   [ ] **Define Enhanced Syntax:** Formalize the new patterns to support beyond the current implementation.
    *   `**` for matching directories at any depth.
    *   `!` for negating a pattern (re-including a file that was previously ignored).
    *   Wildcards (`*`) anywhere in the pattern, not just at the start/end.
*   [ ] **Establish a Rule Hierarchy:** Define the order in which ignore rules are applied.
    1.  **Default Rules (Hardcoded):** A built-in list of common ignores (`.git`, `.DS_Store`, etc.) that are always active.
    2.  **Global Ignore File:** A user-specific file (e.g., `~/.config/dircontxt/ignore`) that applies to every project.
    3.  **Project-Specific Ignore File:** The `.dircontxtignore` file in the target directory (highest priority).
*   [ ] **Plan Data Structure Changes:** Determine what modifications are needed for the `IgnoreRule` struct in `datatypes.h` to accommodate the new syntax (e.g., a flag for negation).

### Phase 2: Implementation

*   [ ] **Modify `datatypes.h`:** Update the `IgnoreRule` struct with new fields to represent pattern types (e.g., negation, globstar `**`).
*   [ ] **Enhance `ignore.c` - `parse_ignore_pattern_line()`:** Rewrite the parser to understand and correctly categorize the new, advanced syntax.
*   [ ] **Upgrade `ignore.c` - `load_ignore_rules()`:** Modify this function to implement the new hierarchy:
    1.  First, add the hardcoded default rules to the list.
    2.  Next, search for and load the global ignore file.
    3.  Finally, load the project-specific `.dircontxtignore` file.
*   [ ] **Rewrite `ignore.c` - `should_ignore_item()`:** Overhaul the matching logic to correctly handle the new patterns. The logic must respect the rule hierarchy, especially the `!` negation patterns, which should override any previous matching ignore rule.

### Phase 3: Testing and Documentation

*   [ ] **Expand `Makefile` `run` Target:** Add more complex file and directory structures to the `test_dir` to validate the new ignore rules (e.g., nested folders, files that should be negated).
*   [ ] **Update Documentation:** Thoroughly document the new, advanced ignore syntax and the concept of the global ignore file in the `README.md`.

***

## Prompt for Gemini LLM

Here is a structured prompt designed to guide an AI to perform the implementation tasks described above.

**Prompt Starts Here**
---

### High-Level Goal

Your task is to upgrade the file/directory ignore system in the provided `dircontxt` C project. The goal is to enhance its capabilities to more closely match the functionality of `.gitignore`, including support for more advanced patterns and a hierarchical configuration system (default, global, and project-level ignores).

### Context

You are being provided with the complete source code of the `dircontxt` project in the `[DIRCONTXT_LLM_SNAPSHOT_V1.2]` format. The current system uses a `.dircontxtignore` file and is implemented primarily in `src/ignore.c`, `src/ignore.h`, and `src/datatypes.h`. The current implementation is basic and needs to be significantly expanded.

*(You would paste the full project snapshot from the previous turn here)*

### Core Requirements

1.  **Expand Pattern Syntax:** The ignore system must be updated to parse and correctly match the following patterns:
    *   **Negation:** Patterns starting with `!` should re-include a file that was matched by a previous pattern. For example, if `*.log` is ignored, `!important.log` should ensure that `important.log` is **not** ignored.
    *   **Deep Directory Matching (`**`):** The `**` pattern should match directories at any level. For example, `foo/**/bar` should match `foo/bar`, `foo/a/bar`, `foo/a/b/bar`, etc.
    *   **General Wildcards (`*`):** The `*` wildcard should be usable anywhere in a pattern, not just at the beginning of an extension. For example, `config-*.json` should match `config-dev.json` and `config-prod.json`.

2.  **Implement a Default Ignore List:** A hardcoded, non-configurable list of patterns should be applied by default to every run. This list should be the lowest priority and should include common patterns like:
    *   `.git/`
    *   `.DS_Store`
    *   `node_modules/`

3.  **Implement a Global Ignore File:** The application should look for a global ignore file at a standard user location (e.g., `~/.config/dircontxt/ignore`). If this file exists, its rules should be loaded after the default list but before the project-specific file.

### Implementation Guidance

You should focus your modifications on the following files.

#### 1. `src/datatypes.h`

*   Modify the `IgnoreRule` struct to support the new syntax. I suggest adding an `enum` for pattern complexity and a `bool` for negation.
    ```c
    // Example suggestion
    typedef enum {
        PATTERN_EXACT,
        PATTERN_SUFFIX,
        PATTERN_SUBSTRING, // For general wildcards
        PATTERN_PATH_GLOB  // For patterns with '**'
    } PatternType;

    typedef struct {
      char pattern[MAX_PATH_LEN];
      PatternType type;
      bool is_dir_only;
      bool is_negation; // Add this field
    } IgnoreRule;
    ```

#### 2. `src/ignore.c`

This file will require the most significant changes.

*   **`parse_ignore_pattern_line()`**:
    *   Rewrite this function to detect the new syntax.
    *   Check for a leading `!` to set the `is_negation` flag.
    *   Detect `**` and `*` to set the appropriate `PatternType`.
    *   Remember to strip the `!` from the `pattern` field after setting the flag.

*   **`load_ignore_rules()`**:
    *   Change this function's logic to load rules in the correct order of precedence:
        1.  Start by adding the hardcoded **default rules** to the rules array.
        2.  Next, construct the path to the **global ignore file** (e.g., by getting the `HOME` environment variable). If it exists, parse it and append its rules.
        3.  Finally, look for the **project-specific `.dircontxtignore`** and append its rules.

*   **`should_ignore_item()`**:
    *   This function must be completely overhauled.
    *   It should iterate through all loaded rules from lowest to highest priority.
    *   It should keep track of the latest matching rule. A simple approach is to have a `bool ignored = false;` and an `int last_match_priority = -1;`.
    *   For each rule, check if it matches the item's path.
    *   If a rule matches:
        *   If it's a **negation rule** (`is_negation = true`), the item should be marked as **not ignored**.
        *   If it's a **standard rule**, the item should be marked as **ignored**.
    *   The final decision should be based on the **last rule in the list that matches the item**.

### Deliverables

Please provide the following as your response:

1.  A list of all the files you have modified.
2.  The complete, updated source code for each of the modified files (`datatypes.h` and `ignore.c`).
3.  A brief summary of the changes you made and how they fulfill the requirements.
</FILE_CONTENT_END ID="F005">
